<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status ↔ Progress Bidirectional Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .demo-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .project-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            background: #fafafa;
        }
        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .status-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .status-planification { background: #e3f2fd; color: #1976d2; }
        .status-en-attente { background: #fff3e0; color: #f57c00; }
        .status-en-cours { background: #e8f5e8; color: #2e7d32; }
        .status-en-retard { background: #ffebee; color: #d32f2f; }
        .status-termine { background: #f3e5f5; color: #7b1fa2; }
        .status-annule { background: #fafafa; color: #616161; }
        
        .progress-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }
        .progress-bar {
            flex: 1;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        .slider {
            width: 100%;
            margin: 15px 0;
        }
        .demo-text {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 5px solid #4caf50;
        }
        .status-change {
            background: #fff3e0;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 5px solid #ff9800;
            font-size: 14px;
            font-weight: 500;
        }
        .scenario {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 5px solid #2196f3;
        }
        .completed-date {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
            font-style: italic;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }
        .arrow {
            font-size: 20px;
            color: #2196f3;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h2>🔄 Status ↔ Progress Bidirectional Sync</h2>
        
        <div class="demo-text">
            <strong>Logique bidirectionnelle complète :</strong><br>
            • <strong>Progress → Status</strong> : Changer le progrès met à jour le statut<br>
            • <strong>Status → Progress</strong> : Changer le statut met à jour le progrès<br>
            • <strong>Synchronisation automatique</strong> dans les deux sens !
        </div>

        <div class="project-card">
            <h3>Projet Test - Synchronisation Bidirectionnelle</h3>
            
            <div class="controls">
                <div class="control-group">
                    <div class="control-label">STATUT (cliquez pour changer)</div>
                    <div>
                        <span id="status" class="status-badge status-planification" onclick="changeStatus('Planification')">Planification</span>
                        <span class="status-badge status-en-attente" onclick="changeStatus('En attente')">En attente</span>
                        <span class="status-badge status-en-cours" onclick="changeStatus('En cours')">En cours</span>
                        <span class="status-badge status-en-retard" onclick="changeStatus('En retard')">En retard</span>
                        <span class="status-badge status-termine" onclick="changeStatus('Terminé')">Terminé</span>
                    </div>
                </div>
                
                <div class="arrow">↔</div>
                
                <div class="control-group">
                    <div class="control-label">PROGRESS (glissez pour changer)</div>
                    <div class="progress-container">
                        <span>0%</span>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span>100%</span>
                        <span id="progressValue" style="font-weight: bold; color: #2196f3;">0%</span>
                    </div>
                    <input type="range" class="slider" min="0" max="100" value="0" id="progressSlider" oninput="updateProgress(this.value)">
                </div>
            </div>
            
            <div id="completedDate" class="completed-date" style="display: none;"></div>
            <div id="statusChange" class="status-change" style="display: none;"></div>
        </div>

        <div class="scenario">
            <h4>🧪 Scénarios de test bidirectionnels :</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h5>📈 Progress → Status :</h5>
                    <ul>
                        <li><strong>0%</strong> → Status "Planification"</li>
                        <li><strong>1-99%</strong> → Status "En cours"</li>
                        <li><strong>100%</strong> → Status "Terminé" + date</li>
                    </ul>
                </div>
                <div>
                    <h5>📊 Status → Progress :</h5>
                    <ul>
                        <li><strong>"Planification"</strong> → Progress 0%</li>
                        <li><strong>"En cours"</strong> → Progress 50%</li>
                        <li><strong>"Terminé"</strong> → Progress 100% + date</li>
                        <li><strong>"En attente/retard"</strong> → Progress 75%</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="demo-text">
            <strong>Fonctionnalités :</strong><br>
            ✅ <strong>Progress → Status</strong> : Automatique<br>
            ✅ <strong>Status → Progress</strong> : Automatique<br>
            ✅ <strong>Date de completion</strong> : Gérée automatiquement<br>
            ✅ <strong>Synchronisation</strong> : Parfaite dans les deux sens<br>
            ✅ <strong>Interface intuitive</strong> : Cliquez ou glissez
        </div>
    </div>

    <script>
        let currentStatus = 'Planification';
        let currentProgress = 0;
        let isUpdatingFromStatus = false;
        let isUpdatingFromProgress = false;

        function changeStatus(newStatus) {
            if (isUpdatingFromProgress) return;
            
            isUpdatingFromStatus = true;
            const oldStatus = currentStatus;
            const oldProgress = currentProgress;
            
            // Update status
            currentStatus = newStatus;
            updateStatusDisplay();
            
            // Auto-update progress based on status
            let newProgress = currentProgress;
            let changeMessage = '';
            
            if (newStatus === 'Terminé' && oldProgress < 100) {
                newProgress = 100;
                changeMessage = '✅ Status "Terminé" → Progress automatiquement mis à 100% + date de completion';
            } else if (newStatus === 'Planification' && oldProgress > 0) {
                newProgress = 0;
                changeMessage = '⬅️ Status "Planification" → Progress automatiquement mis à 0%';
            } else if (newStatus === 'En cours' && oldProgress === 0) {
                newProgress = 50;
                changeMessage = '🔄 Status "En cours" → Progress automatiquement mis à 50%';
            } else if ((newStatus === 'En attente' || newStatus === 'En retard') && oldProgress === 100) {
                newProgress = 75;
                changeMessage = '⏸️ Status "' + newStatus + '" → Progress automatiquement mis à 75%';
            }
            
            if (newProgress !== currentProgress) {
                currentProgress = newProgress;
                updateProgressDisplay();
                showStatusChange(changeMessage);
            }
            
            setTimeout(() => {
                isUpdatingFromStatus = false;
            }, 100);
        }

        function updateProgress(value) {
            if (isUpdatingFromStatus) return;
            
            isUpdatingFromProgress = true;
            const oldProgress = currentProgress;
            const oldStatus = currentStatus;
            
            // Update progress
            currentProgress = parseInt(value);
            updateProgressDisplay();
            
            // Auto-update status based on progress
            let newStatus = currentStatus;
            let changeMessage = '';
            
            if (currentProgress >= 100) {
                newStatus = 'Terminé';
                changeMessage = '✅ Progress 100% → Status automatiquement changé à "Terminé" + date de completion';
            } else if (currentProgress > 0) {
                if (oldStatus === 'Planification') {
                    newStatus = 'En cours';
                    changeMessage = '🔄 Progress démarré → Status automatiquement changé à "En cours"';
                } else if (oldStatus === 'Terminé') {
                    newStatus = 'En cours';
                    changeMessage = '⬇️ Retour en arrière → Status automatiquement changé à "En cours"';
                }
            } else { // progress == 0
                if (oldStatus !== 'Planification') {
                    newStatus = 'Planification';
                    changeMessage = '⬅️ Retour à 0% → Status automatiquement changé à "Planification"';
                }
            }
            
            if (newStatus !== currentStatus) {
                currentStatus = newStatus;
                updateStatusDisplay();
                showStatusChange(changeMessage);
            }
            
            setTimeout(() => {
                isUpdatingFromProgress = false;
            }, 100);
        }

        function updateStatusDisplay() {
            const statusElement = document.getElementById('status');
            statusElement.textContent = currentStatus;
            statusElement.className = 'status-badge status-' + currentStatus.toLowerCase().replace(' ', '-');
        }

        function updateProgressDisplay() {
            const progressFill = document.getElementById('progressFill');
            const progressValue = document.getElementById('progressValue');
            const progressSlider = document.getElementById('progressSlider');
            const completedDate = document.getElementById('completedDate');
            
            progressFill.style.width = currentProgress + '%';
            progressValue.textContent = currentProgress + '%';
            progressSlider.value = currentProgress;
            
            // Handle completed date
            if (currentProgress >= 100 && currentStatus === 'Terminé') {
                const now = new Date();
                const dateStr = now.toLocaleDateString('fr-FR') + ' ' + now.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'});
                completedDate.textContent = 'Date de completion: ' + dateStr;
                completedDate.style.display = 'block';
            } else {
                completedDate.style.display = 'none';
            }
        }

        function showStatusChange(message) {
            const statusChange = document.getElementById('statusChange');
            statusChange.textContent = message;
            statusChange.style.display = 'block';
            
            setTimeout(() => {
                statusChange.style.display = 'none';
            }, 4000);
        }
    </script>
</body>
</html>
